<div *ngIf="loading"
    class="flex min-h-screen items-center justify-center bg-gradient-to-br from-white via-white to-blue-50">
    <div class="text-center flex flex-col gap-4">
        <div class="h-12 w-12 mx-auto text-blue-600">
            <svg class="animate-spin" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12a9 9 0 1 1-6.219-8.56" />
            </svg>
        </div>
        <p class="text-xl text-gray-900">Loading statistics...</p>
    </div>
</div>

<div *ngIf="error || !stats"
    class="flex min-h-screen items-center justify-center bg-gradient-to-br from-white via-white to-blue-50 p-4">
    <div class="text-center flex flex-col gap-6 max-w-md">
        <svg class="h-16 w-16 mx-auto text-gray-400 opacity-50" xmlns="http://www.w3.org/2000/svg" width="64"
            height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round">
            <path d="M3 3v16a2 2 0 0 0 2 2h16" />
            <path d="m19 9-5 5-4-4-3 3" />
        </svg>
        <div>
            <h1 class="text-2xl font-bold text-gray-900 mb-2">Statistics Not Available</h1>
            <p class="text-gray-600">{{ error }}</p>
        </div>
        <button (click)="goBack()"
            class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors h-9 px-3 border border-gray-300 bg-white hover:bg-gray-100 text-gray-900">
            <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m12 19-7-7 7-7" />
                <path d="M19 12H5" />
            </svg>
            Back to Home
        </button>
    </div>
</div>

<div *ngIf="!loading && stats" class="min-h-screen bg-gradient-to-br from-white via-white to-blue-50 p-4 sm:p-8">
    <div class="max-w-6xl mx-auto flex flex-col gap-6">
        <!-- Header -->
        <div class="flex items-center gap-4">
            <button (click)="goBack()"
                class="inline-flex cursor-pointer items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors h-9 px-3 hover:bg-gray-100 text-gray-700">
                <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m12 19-7-7 7-7" />
                    <path d="M19 12H5" />
                </svg>
                Back
            </button>
            <svg class="h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" width="32" height="32"
                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M3 3v16a2 2 0 0 0 2 2h16" />
                <path d="m19 9-5 5-4-4-3 3" />
            </svg>
            <h1 class="text-3xl font-bold text-gray-900">Link Analytics</h1>
        </div>

        <!-- Overview Cards -->
        <div class="rounded-lg border border-gray-200/50 bg-white/80 backdrop-blur-sm shadow-lg p-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Total Clicks -->
                <div class="p-4 rounded-lg bg-blue-50 border border-blue-200">
                    <div class="flex items-center gap-2 mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="rgb(95, 66, 240)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 4.1 12 6"></path>
                            <path d="m5.1 8-2.9-.8"></path>
                            <path d="m6 12-1.9 2"></path>
                            <path d="M7.2 2.2 8 5.1"></path>
                            <path
                                d="M9.037 9.69a.498.498 0 0 1 .653-.653l11 4.5a.5.5 0 0 1-.074.949l-4.349 1.041a1 1 0 0 0-.74.739l-1.04 4.35a.5.5 0 0 1-.95.074z">
                            </path>
                        </svg>
                        <p class="text-sm font-medium text-gray-600">Total Clicks</p>
                    </div>
                    <p class="text-3xl font-bold text-purple-600">{{stats.clicks}}</p>
                </div>

                <!-- Average Daily Clicks -->
                <div class="p-4 rounded-lg bg-cyan-50 border border-cyan-200">
                    <div class="flex items-center gap-2 mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="rgb(35, 193, 246)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-up h-5 w-5 text-accent"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline><polyline points="16 7 22 7 22 13"></polyline></svg>
                        <p class="text-sm font-medium text-gray-600">Avg. Daily Clicks</p>
                    </div>
                    <p class="text-3xl font-bold text-cyan-500">{{avgClicksPerDay}}</p>
                </div>

                <!-- Created Date -->
                <div class="p-4 rounded-lg bg-gray-50 border border-gray-200">
                    <div class="flex items-center gap-2 mb-2">
                        <svg xmlns="http://www.w3.org2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        <p class="text-sm font-medium text-gray-600">Created</p>
                    </div>
                    <p class="text-sm text-gray-900">{{createdDate}}</p>
                </div>
            </div>
        </div>

        <!-- URL Details Card -->
        <div class="rounded-lg border border-gray-200/50 bg-white/80 backdrop-blur-sm shadow-lg p-8">
            <h2 class="text-xl font-bold text-gray-900 mb-6">Link Details</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Short URL -->
                <div class="p-4 rounded-lg bg-gray-50 border border-gray-200">
                    <div class="flex items-center gap-2 mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 17H7A5 5 0 0 1 7 7h2"></path>
                            <path d="M15 7h2a5 5 0 1 1 0 10h-2"></path>
                            <line x1="8" x2="16" y1="12" y2="12"></line>
                        </svg>
                        <p class="text-sm font-medium text-gray-600">Short URL</p>
                    </div>
                    <a [href]="shortUrl" target="_blank" rel="noopener noreferrer"
                        class="text-purple-600 font-medium hover:underline break-all">
                        {{shortUrl}}
                    </a>
                </div>

                <!-- Original URL -->
                <div class="p-4 rounded-lg bg-gray-50 border border-gray-200">
                    <p class="text-sm font-medium text-gray-600 mb-2 block">Original URL</p>
                    <div class="flex flex-col gap-2">
                        @if (stats.original_url.length > 60) {
                        @if (closed) {
                        <a [href]="stats.original_url" target="_blank" rel="noopener noreferrer"
                            class="text-sm text-gray-700 hover:text-purple-600 break-all">
                            {{ stats.original_url.slice(0,45)}}...
                        </a>
                        <span (click)="closeIt()"
                            class="text-purple-600 cursor-pointer inline-flex items-center gap-1 text-sm font-medium">
                            Show more
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor"
                                width="16px" height="16px">
                                <path
                                    d="M297.4 470.6C309.9 483.1 330.2 483.1 342.7 470.6L534.7 278.6C547.2 266.1 547.2 245.8 534.7 233.3C522.2 220.8 501.9 220.8 489.4 233.3L320 402.7L150.6 233.4C138.1 220.9 117.8 220.9 105.3 233.4C92.8 245.9 92.8 266.2 105.3 278.7L297.3 470.7z" />
                            </svg>
                        </span>
                        }@else {
                        <a [href]="stats.original_url" target="_blank" rel="noopener noreferrer"
                            class="text-sm text-gray-700 hover:text-purple-600 break-all">
                            {{ stats.original_url }}
                        </a>
                        <span (click)="closeIt()"
                            class="text-purple-600 cursor-pointer inline-flex items-center gap-1 text-sm font-medium">
                            Show less
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor"
                                width="16px" height="16px">
                                <path
                                    d="M297.4 169.4C309.9 156.9 330.2 156.9 342.7 169.4L534.7 361.4C547.2 373.9 547.2 394.2 534.7 406.7C522.2 419.2 501.9 419.2 489.4 406.7L320 237.3L150.6 406.6C138.1 419.1 117.8 419.1 105.3 406.6C92.8 394.1 92.8 373.8 105.3 361.3L297.3 169.3z" />
                            </svg>
                        </span>
                        }
                        }@else {
                        <a [href]="stats.original_url" target="_blank" rel="noopener noreferrer"
                            class="text-sm text-gray-700 hover:text-purple-600 break-all">
                            {{ stats.original_url }}
                        </a>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Live Click Feed -->
        <div *ngIf="recentClicks.length > 0"
            class="rounded-lg border border-gray-200/50 bg-white/80 backdrop-blur-sm shadow-lg p-8">
            
            <h2 class="flex gap-2 text-xl font-bold text-gray-900 mb-6"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="rgb(95, 66, 240)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-activity h-5 w-5 text-primary"><path d="M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"></path></svg>Live Click Feed</h2>
            <div class="space-y-3">
                <div *ngFor="let click of recentClicks"
                    class="flex items-center justify-between p-4 rounded-lg bg-gray-50 border border-gray-200">
                    <div class="flex items-center gap-3 flex-wrap">
                        <div class="h-2 w-2 bg-[rgb(95,66,240)] rounded-full animate-pulse"></div>
                        <div *ngIf="click.country" class="flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin h-3 w-3"><path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"></path><circle cx="12" cy="10" r="3"></circle></svg>
                            <span class="text-sm font-medium text-gray-700">
                                {{click.city ? click.city + ', ' + click.country : click.country}}
                            </span>
                        </div>
                        <span *ngIf="click.device_type"
                            class="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full">
                            {{click.device_type}}
                        </span>
                        <span *ngIf="click.browser" class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">
                            {{click.browser}}
                        </span>
                        <p class="text-xs text-gray-500">
                            {{formatDistanceToNow(click.clicked_at)}}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="pt-6 border-t border-gray-200/30">
            <p class="text-sm text-gray-500 text-center">
                ðŸ’¡ Bookmark this page to check your link statistics anytime
            </p>
        </div>
    </div>
